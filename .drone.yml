---
{"kind": "pipeline", "type": "docker", "name": "coding-standard-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "server/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"ALLOW_SKIP_CHANGED": ["^.github/.*", "^changelog/.*", "^docs/.*", "CHANGELOG.md", "CONTRIBUTING.md", "LICENSE", "LICENSE.md", "README.md"]}}, {"name": "coding-standard", "image": "owncloudci/php:7.4", "commands": ["make test-php-style"]}], "depends_on": [], "trigger": {"ref": ["refs/pull/**", "refs/tags/**", "refs/heads/master"]}}
---
{"kind": "pipeline", "type": "docker", "name": "cancel-previous-builds", "clone": {"disable": true}, "steps": [{"name": "cancel-previous-builds", "image": "owncloudci/drone-cancel-previous-builds", "settings": {"DRONE_TOKEN": {"from_secret": "drone_token"}}}], "depends_on": [], "trigger": {"ref": ["refs/pull/**"]}}
---
{"kind": "pipeline", "type": "docker", "name": "phpstan-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "server/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"ALLOW_SKIP_CHANGED": ["^.github/.*", "^changelog/.*", "^docs/.*", "CHANGELOG.md", "CONTRIBUTING.md", "LICENSE", "LICENSE.md", "README.md"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "sqlite", "db_name": "owncloud", "db_host": "sqlite", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "phpstan", "image": "owncloudci/php:7.4", "commands": ["make test-php-phpstan"]}], "depends_on": [], "trigger": {"ref": ["refs/pull/**", "refs/tags/**", "refs/heads/master"]}}
---
{"kind": "pipeline", "type": "docker", "name": "check-starlark", "steps": [{"name": "show-diff", "image": "owncloudci/bazel-buildifier", "commands": ["buildifier --mode=fix .drone.star", "git diff"], "when": {"status": ["failure"]}}], "depends_on": [], "trigger": {"ref": ["refs/pull/**"]}}
---
{"kind": "pipeline", "type": "docker", "name": "phpunit-php7.4-sqlite", "workspace": {"base": "/var/www/owncloud", "path": "server/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/integration/.*", "^tests/js/.*", "^tests/Unit/.*", "^tests/unit/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "phpunit.xml", "yarn.lock", "sonar-project.properties"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "sqlite", "db_name": "owncloud", "db_host": "sqlite", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "phpunit-tests", "image": "owncloudci/php:7.4", "environment": {}, "commands": ["make test-php-unit-dbg"]}, {"name": "coverage-rename", "image": "owncloudci/php:7.4", "commands": ["mv tests/output/clover.xml tests/output/clover-phpunit-php7.4-sqlite.xml"]}, {"name": "coverage-cache-1", "image": "plugins/s3", "settings": {"endpoint": {"from_secret": "cache_s3_endpoint"}, "bucket": "cache", "source": "tests/output/clover-phpunit-php7.4-sqlite.xml", "target": "/-${DRONE_BUILD_NUMBER}", "path_style": true, "strip_prefix": "tests/output", "access_key": {"from_secret": "cache_s3_access_key"}, "secret_key": {"from_secret": "cache_s3_secret_key"}}}], "services": [], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"ref": ["refs/pull/**", "refs/tags/**", "refs/heads/master"]}}
---
{"kind": "pipeline", "type": "docker", "name": "phpunit-php7.4-mysql8.0", "workspace": {"base": "/var/www/owncloud", "path": "server/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/integration/.*", "^tests/js/.*", "^tests/Unit/.*", "^tests/unit/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "phpunit.xml", "yarn.lock", "sonar-project.properties"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "phpunit-tests", "image": "owncloudci/php:7.4", "environment": {}, "commands": ["make test-php-unit-dbg"]}, {"name": "coverage-rename", "image": "owncloudci/php:7.4", "commands": ["mv tests/output/clover.xml tests/output/clover-phpunit-php7.4-mysql8.0.xml"]}, {"name": "coverage-cache-1", "image": "plugins/s3", "settings": {"endpoint": {"from_secret": "cache_s3_endpoint"}, "bucket": "cache", "source": "tests/output/clover-phpunit-php7.4-mysql8.0.xml", "target": "/-${DRONE_BUILD_NUMBER}", "path_style": true, "strip_prefix": "tests/output", "access_key": {"from_secret": "cache_s3_access_key"}, "secret_key": {"from_secret": "cache_s3_secret_key"}}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"ref": ["refs/pull/**", "refs/tags/**", "refs/heads/master"]}}
---
{"kind": "pipeline", "type": "docker", "name": "phpunit-php7.4-postgres9.4", "workspace": {"base": "/var/www/owncloud", "path": "server/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/integration/.*", "^tests/js/.*", "^tests/Unit/.*", "^tests/unit/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "phpunit.xml", "yarn.lock", "sonar-project.properties"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "pgsql", "db_name": "owncloud", "db_host": "postgres", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "phpunit-tests", "image": "owncloudci/php:7.4", "environment": {}, "commands": ["make test-php-unit-dbg"]}, {"name": "coverage-rename", "image": "owncloudci/php:7.4", "commands": ["mv tests/output/clover.xml tests/output/clover-phpunit-php7.4-postgres9.4.xml"]}, {"name": "coverage-cache-1", "image": "plugins/s3", "settings": {"endpoint": {"from_secret": "cache_s3_endpoint"}, "bucket": "cache", "source": "tests/output/clover-phpunit-php7.4-postgres9.4.xml", "target": "/-${DRONE_BUILD_NUMBER}", "path_style": true, "strip_prefix": "tests/output", "access_key": {"from_secret": "cache_s3_access_key"}, "secret_key": {"from_secret": "cache_s3_secret_key"}}}], "services": [{"name": "postgres", "image": "postgres:9.4", "environment": {"POSTGRES_USER": "owncloud", "POSTGRES_PASSWORD": "owncloud", "POSTGRES_DB": "owncloud"}}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"ref": ["refs/pull/**", "refs/tags/**", "refs/heads/master"]}}
---
{"kind": "pipeline", "type": "docker", "name": "sonar-analysis", "workspace": {"base": "/var/www/owncloud", "path": "server/apps/"}, "clone": {"disable": true}, "steps": [{"name": "clone", "image": "owncloudci/alpine:latest", "commands": ["git clone https://github.com/.git .", "git checkout $DRONE_COMMIT"]}, {"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/integration/.*", "^tests/js/.*", "^tests/Unit/.*", "^tests/unit/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "phpunit.xml", "yarn.lock", "sonar-project.properties"]}}, {"name": "cache-restore", "image": "plugins/s3-cache:1", "settings": {"access_key": {"from_secret": "cache_s3_access_key"}, "endpoint": {"from_secret": "cache_s3_endpoint"}, "restore": true, "secret_key": {"from_secret": "cache_s3_secret_key"}}, "when": {"instance": ["drone.owncloud.services", "drone.owncloud.com"]}}, {"name": "composer-install", "image": "owncloudci/php:7.4", "environment": {"COMPOSER_HOME": "/drone/src/.cache/composer"}, "commands": ["make vendor"]}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "sqlite", "db_name": "owncloud", "db_host": "sqlite", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "sync-from-cache", "image": "minio/mc:RELEASE.2020-12-18T10-53-53Z", "environment": {"MC_HOST_cache": {"from_secret": "cache_s3_connection_url"}}, "commands": ["mkdir -p results", "mc mirror cache/cache//-${DRONE_BUILD_NUMBER} results/"]}, {"name": "list-coverage-results", "image": "owncloudci/php:7.4", "commands": ["ls -l results"]}, {"name": "sonarcloud", "image": "sonarsource/sonar-scanner-cli", "environment": {"SONAR_TOKEN": {"from_secret": "sonar_token"}, "SONAR_SCANNER_OPTS": "-Xdebug"}, "when": {"instance": ["drone.owncloud.services", "drone.owncloud.com"]}}, {"name": "purge-cache", "image": "minio/mc:RELEASE.2020-12-18T10-53-53Z", "environment": {"MC_HOST_cache": {"from_secret": "cache_s3_connection_url"}}, "commands": ["mc rm --recursive --force cache/cache//-${DRONE_BUILD_NUMBER}"]}], "depends_on": ["phpunit-php7.4-sqlite", "phpunit-php7.4-mysql8.0", "phpunit-php7.4-postgres9.4"], "trigger": {"ref": ["refs/heads/master", "refs/pull/**", "refs/tags/**", "refs/heads/master"]}}
---
{"kind": "pipeline", "type": "docker", "name": "cliEncryption-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "cliEncryption"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-cli"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "cliEncryption-keys-postgres9.4-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "pgsql", "db_name": "owncloud", "db_host": "postgres", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "cliEncryption"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-cli"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "postgres", "image": "postgres:9.4", "environment": {"POSTGRES_USER": "owncloud", "POSTGRES_PASSWORD": "owncloud", "POSTGRES_DB": "owncloud"}}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "cliEncryption-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "cliEncryption"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-cli"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "cliEncryption-keys-postgres9.4-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "pgsql", "db_name": "owncloud", "db_host": "postgres", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "cliEncryption"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-cli"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "postgres", "image": "postgres:9.4", "environment": {"POSTGRES_USER": "owncloud", "POSTGRES_PASSWORD": "owncloud", "POSTGRES_DB": "owncloud"}}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiMasterKeys-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "apiEncryption"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiMasterKeys-keys-postgres9.4-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "pgsql", "db_name": "owncloud", "db_host": "postgres", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "apiEncryption"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "postgres", "image": "postgres:9.4", "environment": {"POSTGRES_USER": "owncloud", "POSTGRES_PASSWORD": "owncloud", "POSTGRES_DB": "owncloud"}}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiMasterKeys-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "apiEncryption"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiMasterKeys-keys-postgres9.4-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "pgsql", "db_name": "owncloud", "db_host": "postgres", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "apiEncryption"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "postgres", "image": "postgres:9.4", "environment": {"POSTGRES_USER": "owncloud", "POSTGRES_PASSWORD": "owncloud", "POSTGRES_DB": "owncloud"}}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIMasterKey-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "webUIMasterKeyType", "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIMasterKey-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "webUIMasterKeyType", "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiUserKeys-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type user-keys --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "apiEncryption"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiUserKeys-keys-postgres9.4-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "pgsql", "db_name": "owncloud", "db_host": "postgres", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type user-keys --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "apiEncryption"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "postgres", "image": "postgres:9.4", "environment": {"POSTGRES_USER": "owncloud", "POSTGRES_PASSWORD": "owncloud", "POSTGRES_DB": "owncloud"}}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiUserKeys-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type user-keys --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "apiEncryption"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiUserKeys-keys-postgres9.4-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "pgsql", "db_name": "owncloud", "db_host": "postgres", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type user-keys --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "apiEncryption"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "postgres", "image": "postgres:9.4", "environment": {"POSTGRES_USER": "owncloud", "POSTGRES_PASSWORD": "owncloud", "POSTGRES_DB": "owncloud"}}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIUserKeys-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type user-keys --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "webUIUserKeysType", "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIUserKeys-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", ""]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type user-keys --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "BEHAT_SUITE": "webUIUserKeysType", "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-1-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 1, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-2-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 2, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-3-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 3, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-4-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 4, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-5-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 5, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-6-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 6, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-7-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 7, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-8-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 8, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-9-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 9, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-10-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 10, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-11-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 11, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-12-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 12, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-13-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 13, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-14-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 14, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-15-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 15, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-16-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 16, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-17-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 17, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-18-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 18, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-19-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 19, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-20-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 20, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-21-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 21, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-22-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 22, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-23-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 23, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-24-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 24, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-25-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 25, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-26-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 26, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-27-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 27, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-28-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 28, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-29-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 29, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-30-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 30, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-31-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 31, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-32-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 32, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-33-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 33, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-34-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 34, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-35-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 35, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-36-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 36, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-37-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 37, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-38-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 38, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-39-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 39, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-40-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 40, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-1-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 1, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-2-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 2, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-3-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 3, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-4-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 4, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-5-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 5, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-6-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 6, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-7-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 7, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-8-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 8, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-9-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 9, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-10-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 10, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-11-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 11, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-12-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 12, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-13-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 13, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-14-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 14, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-15-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 15, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-16-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 16, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-17-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 17, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-18-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 18, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-19-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 19, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-20-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 20, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-21-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 21, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-22-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 22, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-23-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 23, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-24-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 24, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-25-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 25, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-26-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 26, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-27-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 27, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-28-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 28, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-29-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 29, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-30-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 30, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-31-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 31, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-32-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 32, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-33-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 33, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-34-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 34, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-35-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 35, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-36-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 36, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-37-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 37, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-38-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 38, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-39-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 39, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "apiCoreMKey-40-40-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 40, "RUN_PART": 40, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-api"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "cliCoreMKey-7-1-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "EXPECTED_FAILURES_FILE": "/var/www/owncloud/testrunner/apps/encryption/tests/acceptance/expected-failures-cli.md", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 7, "RUN_PART": 1, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-cli"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "cliCoreMKey-7-2-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "EXPECTED_FAILURES_FILE": "/var/www/owncloud/testrunner/apps/encryption/tests/acceptance/expected-failures-cli.md", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 7, "RUN_PART": 2, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-cli"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "cliCoreMKey-7-3-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "EXPECTED_FAILURES_FILE": "/var/www/owncloud/testrunner/apps/encryption/tests/acceptance/expected-failures-cli.md", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 7, "RUN_PART": 3, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-cli"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "cliCoreMKey-7-4-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "EXPECTED_FAILURES_FILE": "/var/www/owncloud/testrunner/apps/encryption/tests/acceptance/expected-failures-cli.md", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 7, "RUN_PART": 4, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-cli"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "cliCoreMKey-7-5-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "EXPECTED_FAILURES_FILE": "/var/www/owncloud/testrunner/apps/encryption/tests/acceptance/expected-failures-cli.md", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 7, "RUN_PART": 5, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-cli"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "cliCoreMKey-7-6-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "EXPECTED_FAILURES_FILE": "/var/www/owncloud/testrunner/apps/encryption/tests/acceptance/expected-failures-cli.md", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 7, "RUN_PART": 6, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-cli"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "cliCoreMKey-7-7-keys-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "EXPECTED_FAILURES_FILE": "/var/www/owncloud/testrunner/apps/encryption/tests/acceptance/expected-failures-cli.md", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 7, "RUN_PART": 7, "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-cli"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-1-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 1, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-2-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 2, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-3-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 3, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-4-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 4, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-5-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 5, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-6-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 6, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-7-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 7, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-8-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 8, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-9-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 9, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-10-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 10, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-11-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 11, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-12-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 12, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-13-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 13, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-14-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 14, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-15-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 15, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-16-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 16, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-17-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 17, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-18-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 18, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-19-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 19, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-20-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "encryption_copykeys_versions", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 20, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-1-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 1, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-2-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 2, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-3-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 3, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-4-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 4, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-5-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 5, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-6-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 6, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-7-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 7, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-8-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 8, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-9-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 9, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-10-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 10, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-11-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 11, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-12-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 12, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-13-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 13, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-14-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 14, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-15-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 15, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-16-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 16, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-17-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 17, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-18-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 18, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-19-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 19, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "webUIcoreMKey-20-20-keys-chrome-mysql8.0-php7.4", "workspace": {"base": "/var/www/owncloud", "path": "testrunner/apps/"}, "steps": [{"name": "skip-if-unchanged", "image": "owncloudci/drone-skip-pipeline", "when": {"event": ["pull_request"]}, "settings": {"DISALLOW_SKIP_CHANGED": ["^tests/acceptance/.*", "^tests/drone/.*", "^tests/TestHelpers/.*", "^vendor-bin/behat/.*", "^appinfo/.*", "^command/.*", "^controller/.*", "^css/.*", "^db/.*", "^handlers/.*", "^js/.*", "^lib/.*", "^rules/.*", "^src/.*", "^templates/.*", "composer.json", "composer.lock", "Makefile", "package.json", "package-lock.json", "yarn.lock"]}}, {"name": "install-core", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/server", "db_type": "mysql", "db_name": "owncloud", "db_host": "mysql", "db_username": "owncloud", "db_password": "owncloud", "exclude": "apps/"}}, {"name": "install-testrunner", "image": "owncloudci/php:7.4", "commands": ["mkdir /tmp/testrunner", "git clone -b master --depth=1 https://github.com/owncloud/core.git /tmp/testrunner", "rsync -aIX /tmp/testrunner /var/www/owncloud", "cp -r /var/www/owncloud/testrunner/apps/ /var/www/owncloud/server/apps/"]}, {"name": "install-federated", "image": "owncloudci/core", "settings": {"git_reference": "latest", "core_path": "/var/www/owncloud/federated", "db_type": "mysql", "db_name": "owncloud-federated", "db_host": "mysql-federated", "db_username": "owncloud", "db_password": "owncloud"}}, {"name": "configure-federation", "image": "owncloudci/php:7.4", "commands": ["echo 'export TEST_SERVER_FED_URL=http://federated' > /var/www/owncloud/saved-settings.sh", "cd /var/www/owncloud/federated", "php occ a:l", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=federated", "php occ log:manage --level 2", "php occ config:list"]}, {"name": "owncloud-log-federated", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/federated/data/owncloud.log"]}, {"name": "install-extra-apps", "image": "owncloudci/php:7.4", "commands": ["ls /var/www/owncloud/testrunner/apps/files_external || git clone https://github.com/owncloud/files_external.git /var/www/owncloud/testrunner/apps/files_external", "ls /var/www/owncloud/server/apps/files_external || cp -r /var/www/owncloud/testrunner/apps/files_external /var/www/owncloud/server/apps/", "cd /var/www/owncloud/server", "php occ a:l", "php occ a:e files_external", "php occ a:l"]}, {"name": "setup-server-", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ a:l", "php occ a:e ", "php occ a:e testing", "php occ a:l", "php occ config:system:set trusted_domains 1 --value=server", "php occ log:manage --level 2", "php occ config:system:set csrf.disabled --value=true"]}, {"name": "owncloud-log-server", "image": "owncloud/ubuntu:20.04", "detach": true, "commands": ["tail -f /var/www/owncloud/server/data/owncloud.log"]}, {"name": "configure-app", "image": "owncloudci/php:7.4", "commands": ["cd /var/www/owncloud/server", "php occ encryption:enable", "php occ encryption:select-encryption-type masterkey --yes", "php occ config:list"]}, {"name": "wait-for-server", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it server:80 -t 600", "wait-for -it federated:80 -t 600"]}, {"name": "wait-for-email", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it email:8025 -t 600"]}, {"name": "fix-permissions", "image": "owncloudci/php:7.4", "commands": ["chown -R www-data /var/www/owncloud/server", "chown -R www-data /var/www/owncloud/federated", "chmod 777 /home/seluser/Downloads"], "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "wait-for-selenium", "image": "owncloudci/wait-for:latest", "commands": ["wait-for -it selenium:4444 -t 600"]}, {"name": "acceptance-tests", "image": "owncloudci/php:7.4", "environment": {"ENCRYPTION_TYPE": "masterkey", "TEST_SERVER_URL": "http://server", "BEHAT_FILTER_TAGS": "", "DOWNLOADS_DIRECTORY": "/var/www/owncloud/server/downloads", "DIVIDE_INTO_NUM_PARTS": 20, "RUN_PART": 20, "SELENIUM_HOST": "selenium", "SELENIUM_PORT": "4444", "BROWSER": "chrome", "PLATFORM": "Linux", "MAILHOG_HOST": "email"}, "commands": ["touch /var/www/owncloud/saved-settings.sh", ". /var/www/owncloud/saved-settings.sh", "make test-acceptance-core-webui"], "volumes": [{"name": "downloads", "path": "/var/www/owncloud/server/downloads"}]}, {"name": "github-comment", "image": "thegeeklab/drone-github-comment:1", "pull": "if-not-exists", "settings": {"message": ":boom: Acceptance tests pipeline <strong>${DRONE_STAGE_NAME}</strong> failed. The build has been cancelled.\\n\\n${DRONE_BUILD_LINK}/${DRONE_JOB_NUMBER}${DRONE_STAGE_NUMBER}", "key": "pr-${DRONE_PULL_REQUEST}", "update": "true", "api_key": {"from_secret": "github_token"}}, "when": {"status": ["failure"], "event": ["pull_request"]}}, {"name": "stop-build", "image": "drone/cli:alpine", "environment": {"DRONE_SERVER": "https://drone.owncloud.com", "DRONE_TOKEN": {"from_secret": "drone_token"}}, "commands": ["drone build stop owncloud/ ${DRONE_BUILD_NUMBER}"], "when": {"status": ["failure"], "event": ["pull_request"]}}], "services": [{"name": "mysql", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}, {"name": "selenium", "image": "selenium/standalone-chrome-debug:3.141.59-oxygen", "environment": {"JAVA_OPTS": "-Dselenium.LOGGER.level=WARNING"}, "volumes": [{"name": "downloads", "path": "/home/seluser/Downloads"}]}, {"name": "email", "image": "mailhog/mailhog"}, {"name": "server", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/server", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "federated", "image": "owncloudci/php:7.4", "environment": {"APACHE_WEBROOT": "/var/www/owncloud/federated", "APACHE_LOGGING_PATH": "/dev/null"}, "commands": ["/usr/local/bin/apachectl -e debug -D FOREGROUND"]}, {"name": "mysql-federated", "image": "mysql:8.0", "environment": {"MYSQL_USER": "owncloud", "MYSQL_PASSWORD": "owncloud", "MYSQL_DATABASE": "owncloud-federated", "MYSQL_ROOT_PASSWORD": "owncloud"}, "command": ["--default-authentication-plugin=mysql_native_password"]}], "depends_on": ["coding-standard-php7.4", "cancel-previous-builds", "phpstan-php7.4", "check-starlark"], "trigger": {"cron": "nightly"}, "volumes": [{"name": "downloads", "temp": {}}]}
---
{"kind": "pipeline", "type": "docker", "name": "chat-notifications", "clone": {"disable": true}, "steps": [{"name": "notify-rocketchat", "image": "plugins/slack:1", "settings": {"webhook": {"from_secret": "private_rocketchat"}, "channel": "builds"}}], "depends_on": ["sonar-analysis", "cliEncryption-keys-mysql8.0-php7.4", "cliEncryption-keys-postgres9.4-php7.4", "cliEncryption-keys-mysql8.0-php7.4", "cliEncryption-keys-postgres9.4-php7.4", "apiMasterKeys-keys-mysql8.0-php7.4", "apiMasterKeys-keys-postgres9.4-php7.4", "apiMasterKeys-keys-mysql8.0-php7.4", "apiMasterKeys-keys-postgres9.4-php7.4", "webUIMasterKey-keys-chrome-mysql8.0-php7.4", "webUIMasterKey-keys-chrome-mysql8.0-php7.4", "apiUserKeys-keys-mysql8.0-php7.4", "apiUserKeys-keys-postgres9.4-php7.4", "apiUserKeys-keys-mysql8.0-php7.4", "apiUserKeys-keys-postgres9.4-php7.4", "webUIUserKeys-keys-chrome-mysql8.0-php7.4", "webUIUserKeys-keys-chrome-mysql8.0-php7.4", "apiCoreMKey-40-1-keys-mysql8.0-php7.4", "apiCoreMKey-40-2-keys-mysql8.0-php7.4", "apiCoreMKey-40-3-keys-mysql8.0-php7.4", "apiCoreMKey-40-4-keys-mysql8.0-php7.4", "apiCoreMKey-40-5-keys-mysql8.0-php7.4", "apiCoreMKey-40-6-keys-mysql8.0-php7.4", "apiCoreMKey-40-7-keys-mysql8.0-php7.4", "apiCoreMKey-40-8-keys-mysql8.0-php7.4", "apiCoreMKey-40-9-keys-mysql8.0-php7.4", "apiCoreMKey-40-10-keys-mysql8.0-php7.4", "apiCoreMKey-40-11-keys-mysql8.0-php7.4", "apiCoreMKey-40-12-keys-mysql8.0-php7.4", "apiCoreMKey-40-13-keys-mysql8.0-php7.4", "apiCoreMKey-40-14-keys-mysql8.0-php7.4", "apiCoreMKey-40-15-keys-mysql8.0-php7.4", "apiCoreMKey-40-16-keys-mysql8.0-php7.4", "apiCoreMKey-40-17-keys-mysql8.0-php7.4", "apiCoreMKey-40-18-keys-mysql8.0-php7.4", "apiCoreMKey-40-19-keys-mysql8.0-php7.4", "apiCoreMKey-40-20-keys-mysql8.0-php7.4", "apiCoreMKey-40-21-keys-mysql8.0-php7.4", "apiCoreMKey-40-22-keys-mysql8.0-php7.4", "apiCoreMKey-40-23-keys-mysql8.0-php7.4", "apiCoreMKey-40-24-keys-mysql8.0-php7.4", "apiCoreMKey-40-25-keys-mysql8.0-php7.4", "apiCoreMKey-40-26-keys-mysql8.0-php7.4", "apiCoreMKey-40-27-keys-mysql8.0-php7.4", "apiCoreMKey-40-28-keys-mysql8.0-php7.4", "apiCoreMKey-40-29-keys-mysql8.0-php7.4", "apiCoreMKey-40-30-keys-mysql8.0-php7.4", "apiCoreMKey-40-31-keys-mysql8.0-php7.4", "apiCoreMKey-40-32-keys-mysql8.0-php7.4", "apiCoreMKey-40-33-keys-mysql8.0-php7.4", "apiCoreMKey-40-34-keys-mysql8.0-php7.4", "apiCoreMKey-40-35-keys-mysql8.0-php7.4", "apiCoreMKey-40-36-keys-mysql8.0-php7.4", "apiCoreMKey-40-37-keys-mysql8.0-php7.4", "apiCoreMKey-40-38-keys-mysql8.0-php7.4", "apiCoreMKey-40-39-keys-mysql8.0-php7.4", "apiCoreMKey-40-40-keys-mysql8.0-php7.4", "apiCoreMKey-40-1-keys-mysql8.0-php7.4", "apiCoreMKey-40-2-keys-mysql8.0-php7.4", "apiCoreMKey-40-3-keys-mysql8.0-php7.4", "apiCoreMKey-40-4-keys-mysql8.0-php7.4", "apiCoreMKey-40-5-keys-mysql8.0-php7.4", "apiCoreMKey-40-6-keys-mysql8.0-php7.4", "apiCoreMKey-40-7-keys-mysql8.0-php7.4", "apiCoreMKey-40-8-keys-mysql8.0-php7.4", "apiCoreMKey-40-9-keys-mysql8.0-php7.4", "apiCoreMKey-40-10-keys-mysql8.0-php7.4", "apiCoreMKey-40-11-keys-mysql8.0-php7.4", "apiCoreMKey-40-12-keys-mysql8.0-php7.4", "apiCoreMKey-40-13-keys-mysql8.0-php7.4", "apiCoreMKey-40-14-keys-mysql8.0-php7.4", "apiCoreMKey-40-15-keys-mysql8.0-php7.4", "apiCoreMKey-40-16-keys-mysql8.0-php7.4", "apiCoreMKey-40-17-keys-mysql8.0-php7.4", "apiCoreMKey-40-18-keys-mysql8.0-php7.4", "apiCoreMKey-40-19-keys-mysql8.0-php7.4", "apiCoreMKey-40-20-keys-mysql8.0-php7.4", "apiCoreMKey-40-21-keys-mysql8.0-php7.4", "apiCoreMKey-40-22-keys-mysql8.0-php7.4", "apiCoreMKey-40-23-keys-mysql8.0-php7.4", "apiCoreMKey-40-24-keys-mysql8.0-php7.4", "apiCoreMKey-40-25-keys-mysql8.0-php7.4", "apiCoreMKey-40-26-keys-mysql8.0-php7.4", "apiCoreMKey-40-27-keys-mysql8.0-php7.4", "apiCoreMKey-40-28-keys-mysql8.0-php7.4", "apiCoreMKey-40-29-keys-mysql8.0-php7.4", "apiCoreMKey-40-30-keys-mysql8.0-php7.4", "apiCoreMKey-40-31-keys-mysql8.0-php7.4", "apiCoreMKey-40-32-keys-mysql8.0-php7.4", "apiCoreMKey-40-33-keys-mysql8.0-php7.4", "apiCoreMKey-40-34-keys-mysql8.0-php7.4", "apiCoreMKey-40-35-keys-mysql8.0-php7.4", "apiCoreMKey-40-36-keys-mysql8.0-php7.4", "apiCoreMKey-40-37-keys-mysql8.0-php7.4", "apiCoreMKey-40-38-keys-mysql8.0-php7.4", "apiCoreMKey-40-39-keys-mysql8.0-php7.4", "apiCoreMKey-40-40-keys-mysql8.0-php7.4", "cliCoreMKey-7-1-keys-mysql8.0-php7.4", "cliCoreMKey-7-2-keys-mysql8.0-php7.4", "cliCoreMKey-7-3-keys-mysql8.0-php7.4", "cliCoreMKey-7-4-keys-mysql8.0-php7.4", "cliCoreMKey-7-5-keys-mysql8.0-php7.4", "cliCoreMKey-7-6-keys-mysql8.0-php7.4", "cliCoreMKey-7-7-keys-mysql8.0-php7.4", "webUIcoreMKey-20-1-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-2-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-3-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-4-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-5-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-6-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-7-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-8-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-9-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-10-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-11-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-12-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-13-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-14-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-15-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-16-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-17-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-18-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-19-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-20-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-1-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-2-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-3-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-4-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-5-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-6-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-7-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-8-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-9-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-10-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-11-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-12-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-13-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-14-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-15-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-16-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-17-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-18-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-19-keys-chrome-mysql8.0-php7.4", "webUIcoreMKey-20-20-keys-chrome-mysql8.0-php7.4"], "trigger": {"ref": ["refs/tags/**", "refs/heads/master"], "status": ["success", "failure"]}}
